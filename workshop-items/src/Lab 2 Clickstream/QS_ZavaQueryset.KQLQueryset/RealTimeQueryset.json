{
  "queryset": {
    "version": "1.0.0",
    "dataSources": [
      {
        "id": "c88c5ce2-beda-4d58-9697-7a6989308751",
        "clusterUri": "",
        "type": "Fabric",
        "databaseItemId": "3f2a58aa-c850-80ab-41f3-4de102507405",
        "databaseItemName": "EH_ZavaEcommStore"
      }
    ],
    "tabs": [
      {
        "id": "bbb4715f-9bdf-4c8b-bc70-2919fcf75903",
        "content": ".execute database script <|\n.create table RawClickstreamData (event_id:guid, event_type:string, user_id:guid, session_id:guid, timestamp:datetime, country:string, country_code:string, referral_source:string, click_path:dynamic, payload:dynamic, client_info:dynamic, EventProcessedUtcTime:datetime, PartitionId:string, EventEnqueuedUtcTime:datetime) with (folder = \"Bronze Layer\")\n.create-or-alter function extractAddToCartPayload ()\n{\n    RawClickstreamData\n    | where event_type == \"add_to_cart\"\n    | project product_category = tostring(['click_path'][1])\n            , product_id = tostring(payload.product_id)\n            , quantity_added = toint(payload.quantity_added)\n            , ip_address = tostring(client_info.ip)\n            , browser = tostring(client_info.browser)\n            , os = tostring(client_info.os)\n            , device = tostring(client_info.device)\n            , timestamp\n            , user_id\n            , session_id\n            , event_id\n    | extend country = tostring((geo_info_from_ip_address(ip_address).country))\n            , state = tostring((geo_info_from_ip_address(ip_address).state))\n            , city = tostring((geo_info_from_ip_address(ip_address).city))\n            , latitude = toreal((geo_info_from_ip_address(ip_address).latitude))\n            , longitude = toreal((geo_info_from_ip_address(ip_address).longitude))\n}\n.create-or-alter function extractViewProductPayload ()\n{\n    RawClickstreamData\n    | where event_type == \"view_product\"\n    | project product_id = tostring(payload.product_id)\n        , product_category = tostring(payload.category)\n        , price = toreal(payload.price)\n        , sneaker_category = tostring(payload.sneaker_category)\n        , ip_address = tostring(client_info.ip)\n        , browser = tostring(client_info.browser)\n        , os = tostring(client_info.os)\n        , device = tostring(client_info.device)\n        , country\n        , timestamp\n        , user_id\n        , session_id\n        , event_id\n}\n.create-or-alter function extractCreateAccountPayload ()\n{\n    RawClickstreamData\n    | where event_type == \"create_account\"\n    | project account_type = tostring(payload.account_type)\n            , ip_address = tostring(client_info.ip)\n            , browser = tostring(client_info.browser)\n            , os = tostring(client_info.os)\n            , device = tostring(client_info.device)\n            , country\n            , timestamp\n            , user_id\n            , session_id\n            , event_id\n}\n.create-or-alter function extractNewsletterPayload ()\n{\n    RawClickstreamData\n    | where event_type in (\"unsubscribe_mailing_list\", \"subscribe_mailing_list\")\n    | project event_type\n            , subscribed = tobool(payload.subscribed)\n            , ip_address = tostring(client_info.ip)\n            , browser = tostring(client_info.browser)\n            , os = tostring(client_info.os)\n            , device = tostring(client_info.device)\n            , country\n            , timestamp\n            , user_id\n            , session_id\n            , event_id\n}\n.create-or-alter function extractBrowseCategoryPayload()\n{\n    RawClickstreamData\n    | where event_type == \"browse_category\"\n    | project product_category = tostring(payload.category)\n            , sneaker_category = tostring(payload.sneaker_category)\n            , ip_address = tostring(client_info.ip)\n            , browser = tostring(client_info.browser)\n            , os = tostring(client_info.os)\n            , device = tostring(client_info.device)\n            , country\n            , timestamp\n            , user_id\n            , session_id\n            , event_id\n}\n.create table Clickstream_AddToCart (product_category:string, product_id:string, quantity_added:int, ip_address:string, browser:string, os:string, device:string, timestamp:datetime, user_id:guid, session_id:guid, event_id:guid, country:string, state:string, city:string, latitude:real, longitude:real) with (folder =\"Silver Layer\")\n.create table Clickstream_BrowseCategory (product_category:string, sneaker_category:string, ip_address:string, browser:string, os:string, device:string, country:string, timestamp:datetime, user_id:guid, session_id:guid, event_id:guid) with (folder =\"Silver Layer\")\n.create table Clickstream_CreateAccount (account_type:string, ip_address:string, browser:string, os:string, device:string, country:string, timestamp:datetime, user_id:guid, session_id:guid, event_id:guid) with (folder =\"Silver Layer\")\n.create table Clickstream_Newsletter (event_type:string, subscribed:bool, ip_address:string, browser:string, os:string, device:string, country:string, timestamp:datetime, user_id:guid, session_id:guid, event_id:guid) with (folder =\"Silver Layer\")\n.create table Clickstream_ViewProduct (product_id:string, product_category:string, price:real, sneaker_category:string, ip_address:string, browser:string, os:string, device:string, country:string, timestamp:datetime, user_id:guid, session_id:guid, event_id:guid) with (folder =\"Silver Layer\")\n.alter table Clickstream_Newsletter policy update\n```[{\n    \"IsEnabled\": true,\n    \"Source\": \"RawClickstreamData\",\n    \"Query\": \"extractNewsletterPayload\",\n    \"IsTransactional\": false,\n    \"PropagateIngestionProperties\": true\n}]```\n.alter table Clickstream_AddToCart policy update\n```[{\n    \"IsEnabled\": true,\n    \"Source\": \"RawClickstreamData\",\n    \"Query\": \"extractAddToCartPayload\",\n    \"IsTransactional\": false,\n    \"PropagateIngestionProperties\": true\n}]```\n.alter table Clickstream_CreateAccount policy update\n```[{\n    \"IsEnabled\": true,\n    \"Source\": \"RawClickstreamData\",\n    \"Query\": \"extractCreateAccountPayload\",\n    \"IsTransactional\": false,\n    \"PropagateIngestionProperties\": true\n}]```\n.alter table Clickstream_BrowseCategory policy update\n```[{\n    \"IsEnabled\": true,\n    \"Source\": \"RawClickstreamData\",\n    \"Query\": \"extractBrowseCategoryPayload\",\n    \"IsTransactional\": false,\n    \"PropagateIngestionProperties\": true\n}]```\n.alter table Clickstream_ViewProduct policy update\n```[{\n    \"IsEnabled\": true,\n    \"Source\": \"RawClickstreamData\",\n    \"Query\": \"extractViewProductPayload\",\n    \"IsTransactional\": false,\n    \"PropagateIngestionProperties\": true\n}]```",
        "title": "",
        "dataSourceId": "c88c5ce2-beda-4d58-9697-7a6989308751"
      }
    ]
  }
}